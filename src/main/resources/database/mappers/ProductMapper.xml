<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.thr.i1.product.ProductDAO">
  	<!-- Product List 카테고리별로 구분, 검색(전체) -->
  	<resultMap type="ProductDTO" id="getListResult">
  		<id column="id" property="id"/>
  		<result column="category" property="category"/>
  		<result column="name" property="name"/>
  		<result column="price" property="price"/>
  		<result column="explain" property="explain"/>
  		<result column="etc" property="etc"/>
  		<association property="productCategoryDTO" javaType="ProductCategoryDTO">
  			<id column="category" property="category"/>
  			<result column="cateName" property="cateName"/>
  			<result column="cateRef1" property="cateRef1"/>
  			<result column="cateRef2" property="cateRef2"/>
  		</association>
  	</resultMap>
	<select id="getList" parameterType="Map" resultMap="getListResult">
		SELECT * FROM 
			(SELECT ROWNUM R, PRO.* FROM 
				(SELECT * FROM PRODUCT P INNER JOIN PRODUCT_CATEGORY PC 
				ON P.CATEGORY = PC.CATEGORY 
				<if test="product.category!=null">
				WHERE P.CATEGORY=#{product.category} OR PC.CATEREF1=#{product.category} OR PC.CATEREF2=#{product.category}
				</if>
				) PRO) 
		WHERE R BETWEEN #{pager.startRow} AND #{pager.lastRow}
	</select>
	
 	<!-- 카테고리별 게시물 수 -->
 	<select id="getCount" parameterType="ProductDTO" resultType="Long">
		SELECT COUNT(ID) FROM PRODUCT P INNER JOIN PRODUCT_CATEGORY PC 
		ON P.CATEGORY = PC.CATEGORY 
		<if test="category!=null">
		WHERE P.CATEGORY=#{category} OR PC.CATEREF1=#{category} OR PC.CATEREF2=#{category}
		</if>
	</select>
	
	<!-- 상품 상세 페이지 보기 -->
	<select id="getSelect" parameterType="ProductDTO" resultType="ProductDTO">
		SELECT * FROM PRODUCT WHERE ID=#{id}
	</select>
	
  
  </mapper>